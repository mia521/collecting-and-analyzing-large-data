---
title: "MGTA 452 - Assignment 2. Due November 1 at 12pm"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

--- 
**Note: This is an individual assignment that you should complete on your own**

The data folder contains observations of selling prices for three different types of gasoline (e5, e10 and diesel) at the hourly level (from 6am to 8pm) for each day for one month for (almost) all gas stations in Germany. There are four data files - one for each gas type and another file with information on each gas station. 

The columns in the gas price data are for the first gas type (e5) are:

- **station_uuid**: a unique code for each gas station
- **day**: the date 
- **hour**: hour of day (6 = 6am, 20 = 8pm)
- **e5**: the price for one liter of gas in Euros  

The columns for the e10 and diesel types follow the same format (only difference is the name of the price column (e10 and disel)).

The columns in the station file are self-explanatory (*brand* is the brand of the station - like Shell or Mobil in California.)

### Question 1

<span style="color:blue">
Start by creating a tidy data frame containing all three gas prices where each row is a price for a certain **station** x **day** x **hour** x **gas type** combination. So the data frame should have the following columns: station id, day, hour, price and type. Your resulting data frame should have 17,933,488 rows. (note: there are many different ways of doing this!) 
</span>

```{r}
# import tidyverse and read data
library(tidyverse)
diesel <- readRDS('data/diesel.rds')
e5 <- readRDS('data/e5.rds')
e10 <- readRDS('data/e10.rds')

# convert list to dataframe
diesel<-as.data.frame(diesel)
e5<-as.data.frame(e5)
e10<-as.data.frame(e10)

# change column name and add column
colnames(diesel) <- c('station_uuid', 'day','hour','price')
colnames(e5) <- c('station_uuid', 'day','hour','price')
colnames(e10) <- c('station_uuid', 'day','hour','price')
diesel$type<-'diesel'
e5$type<-'e5'
e10$type<-'e10'

# join dataframes
df<-full_join(diesel,e5)
df<-full_join(df,e10)
nrow(df)
```

### Question 2

<span style="color:blue">
(A) Which of three types of gasoline has the biggest and smallest average price (across all stations and day/time)? (B) There is a common belief that diesel prices vary less then regular gas (e5,e10) - can you find support for that claim with this data? 

Base your answer on summary statistics.
</span>

```{r}
library(dplyr)
df %>% group_by(type) %>% summarise(average = mean(price)) %>% arrange()
df %>% group_by(type) %>% summarise(var = var(price)) %>% arrange()
```

(A) e5 has the biggest average price and diesel has the smallest average price
(B) In fact, diesel prices vary more than regular gas (e5,e10) as diesel has the biggest variance among the three type of gases.

### Question 3

<span style="color:blue">
If gas prices vary by day of the week, then you can save money by getting gas on cheap days. Consider the seven days of the week - each day will have a different average price for each gas type. How much money can you save - **on average** - if you get gas on the cheapest day of the week versus the most expensive day of the week?

Hint: you can get day of week by using the function *weekdays* on a date. 
</span>

```{r}
weekday <- df %>% group_by(type, weekdays(df[,2])) %>% summarise(average = mean(price)) %>% arrange()
weekday %>% group_by(type) %>% summarize(saving=max(average)-min(average))
```

### Question 4

<span style="color:blue">
Prices may vary throughout the day - so maybe we can save more money by getting gas on certain hours of the day? Each hour of the day have a different average price for each gas type. How much money can you save - **on average** - if you get gas on the cheapest hour of the week versus the most expansive hour of the day?
</span>

```{r}
hour <- df %>% group_by(hour, type) %>% summarise(average = mean(price)) %>% arrange()
hour %>% group_by(type) %>% summarize(saving=max(average)-min(average))
```

### Question 5

<span style="color:blue">
Can we get cheaper gas by visiting a certain gas station? Like products, gas stations have different brand names. Find the **three cheapest and three most expensive gas station brands** in terms of average price for each gas type for all stations of that brand. How much money can you save by visiting the cheapest versus the most expensive? </span>

```{r}
stations <- read_csv('data/stations.csv')
stations <-as.data.frame(stations) %>% select(station_uuid, brand, city) %>% na.omit()
station <- df %>% group_by(type, station_uuid) %>% summarise(average = mean(price))
stations <- left_join(stations, station) %>% na.omit() 

stations %>% group_by(type) %>% arrange(desc(average)) %>% top_n(3) %>% select(type, brand, average)

stations %>% group_by(type) %>% arrange(average) %>% top_n(-3) %>% select(type, brand, average)

```

```{r}
station %>% group_by(type) %>% summarise(saving =max(average)-min(average)) 
```

### Question 6

<span style="color:blue">
Assume you work as a data scientist in a large bank and your boss tells you: "quick - I need the average selling price for each type of gas in the German cities Berlin, Hamburg, Frankfurt and Bremen! And I want the result as a table with one row per city and one column per gas type!". 

Calculate these averages - your result should a data frame that matches your bosses desired format.

Note: This data - being real data - is not completely clean. For example, some gas stations report their city as "Berlin" while others use "BERLIN" - similarly for the other cities. You should take this into account when doing your calculation.    </span>

```{r}
stations <- read_csv('data/stations.csv')
stations <-as.data.frame(stations)
city <- left_join(stations, df)
city[,7]  <- tolower(city[,7])
list <- city %>% filter(city == 'berlin'|city == 'hamburg'|city == 'frankfurt'|city == 'bremen') %>% group_by(city, type) %>% summarise(average=mean(price)) %>% drop_na()
average <- matrix(c(list$average),ncol=3,byrow=TRUE)
colnames(average) <- c('diesel','e10','e5')
rownames(average) <- c('berlin','bremen','frankfurt','hamburg')
average

```

### Question 7

<span style="color:blue">
Suppose you boss instead had asked you: "I want the price that the average customer pays for gas in Berlin and Hamburg". Can you calculate this based on the data you currently have - yes/no? If not - what other data do you need?
</span>

I cannot. The price that the average customer pays for gas is equal to the total gas bought divided by the total number of customers in the city. I need the data on total purchase history in each city.
